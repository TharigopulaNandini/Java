import pdfplumber
from reportlab.pdfgen import canvas
from reportlab.lib.pagesizes import letter

def extract_rects_with_width(pdf_path, output_pdf_path, page_number=0):
    with pdfplumber.open(pdf_path) as pdf:
        page = pdf.pages[page_number]

        # Extract rectangles (cell boundaries)
        rects = page.objects.get("rect", [])
        
        # Create a new PDF to draw on
        c = canvas.Canvas(output_pdf_path, pagesize=letter)

        # Store the boundaries of the table cells (left, bottom, right, top)
        cell_boundaries = []

        for rect in rects:
            if 'x0' in rect and 'y0' in rect and 'x1' in rect and 'y1' in rect:
                x0, y0, x1, y1 = rect['x0'], rect['y0'], rect['x1'], rect['y1']
                cell_boundaries.append((x0, y0, x1, y1))

        # Sort the cell boundaries to separate them into horizontal and vertical lines
        cell_boundaries.sort(key=lambda x: (x[1], x[0]))  # Sort by bottom (y0) and left (x0)

        # Draw the existing lines (cell boundaries)
        for rect in rects:
            if 'x0' in rect and 'y0' in rect and 'x1' in rect and 'y1' in rect:
                c.setStrokeColorRGB(0, 0, 0)  # Black color for original lines
                c.setLineWidth(1)
                c.line(rect['x0'], rect['y0'], rect['x1'], rect['y1'])

        # Detect missing horizontal lines and draw them
        for i in range(1, len(cell_boundaries)):
            x0, y0, x1, y1 = cell_boundaries[i]

            # Check for missing horizontal line between cells (bottom of the current cell)
            if i + 1 < len(cell_boundaries) and cell_boundaries[i+1][1] > y1:
                c.setStrokeColorRGB(1, 0, 0)  # Red color for missing lines
                c.setLineWidth(2)
                c.line(x0, y1, x1, y1)  # Draw missing horizontal line

            # Check for missing vertical line between cells (right side of the current cell)
            if i + 1 < len(cell_boundaries) and cell_boundaries[i+1][0] > x1:
                c.setStrokeColorRGB(0, 1, 0)  # Green color for missing lines
                c.line(x1, y0, x1, y1)  # Draw missing vertical line

        # Save the modified PDF with lines
        c.save()

# Example usage
extract_rects_with_width("your_pdf_file.pdf", "output_with_lines.pdf", 0)
