import pdfplumber
from reportlab.pdfgen import canvas
from reportlab.lib.pagesizes import letter

def extract_rects_with_width(pdf_path, output_pdf_path, page_number=0):
    with pdfplumber.open(pdf_path) as pdf:
        page = pdf.pages[page_number]
        
        # Extract rectangles (bounding boxes)
        rects = page.objects.get("rect", [])
        
        # Create a new PDF to draw on
        c = canvas.Canvas(output_pdf_path, pagesize=letter)
        
        # Lists to store horizontal and vertical lines' positions
        horizontal_lines = set()  # Store unique y-values for horizontal lines
        vertical_lines = set()    # Store unique x-values for vertical lines

        # Extract horizontal and vertical lines based on the rectangles
        for rect in rects:
            x0, y0, x1, y1 = rect['x0'], rect['y0'], rect['x1'], rect['y1']
            
            # Horizontal lines (top and bottom)
            horizontal_lines.add(y0)
            horizontal_lines.add(y1)
            
            # Vertical lines (left and right)
            vertical_lines.add(x0)
            vertical_lines.add(x1)
        
        # Sort the lines to detect gaps
        horizontal_lines = sorted(horizontal_lines)
        vertical_lines = sorted(vertical_lines)

        # Draw the existing lines (original horizontal and vertical lines)
        for rect in rects:
            x0, y0, x1, y1 = rect['x0'], rect['y0'], rect['x1'], rect['y1'] 
            
            # Draw original horizontal lines
            c.setStrokeColorRGB(1, 0, 0)  # Red color
            c.setLineWidth(2)
            c.line(x0, y0, x1, y0)  # Top horizontal line
            c.line(x0, y1, x1, y1)  # Bottom horizontal line
            
            # Draw original vertical lines
            c.setStrokeColorRGB(0, 1, 0)  # Green color
            c.line(x0, y0, x0, y1)  # Left vertical line
            c.line(x1, y0, x1, y1)  # Right vertical line
        
        # Draw missing horizontal lines (detect gaps between horizontal lines)
        for i in range(1, len(horizontal_lines)):
            y_gap = horizontal_lines[i] - horizontal_lines[i - 1]
            if y_gap > 1:  # There is a gap between the horizontal lines
                y_start = horizontal_lines[i - 1]
                y_end = horizontal_lines[i]
                c.setStrokeColorRGB(0, 0, 1)  # Blue color for missing lines
                c.setLineWidth(2)
                c.line(0, y_start, page.width, y_start)  # Draw missing horizontal line

        # Draw missing vertical lines (detect gaps between vertical lines)
        for i in range(1, len(vertical_lines)):
            x_gap = vertical_lines[i] - vertical_lines[i - 1]
            if x_gap > 1:  # There is a gap between the vertical lines
                x_start = vertical_lines[i - 1]
                x_end = vertical_lines[i]
                c.setStrokeColorRGB(0, 1, 1)  # Cyan color for missing lines
                c.setLineWidth(2)
                c.line(x_start, 0, x_start, page.height)  # Draw missing vertical line

        # Save the modified PDF with lines
        c.save()

# Example usage
extract_rects_with_width("your_pdf_file.pdf", "output_with_lines.pdf", 0)
