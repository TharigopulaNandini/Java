import pdfplumber
from reportlab.pdfgen import canvas
from reportlab.lib.pagesizes import letter

def extract_rects_with_width(pdf_path, output_pdf_path, page_number=0):
    with pdfplumber.open(pdf_path) as pdf:
        page = pdf.pages[page_number]
        
        # Extract objects (rectangles, lines, etc.)
        rects = page.objects.get("rect", [])
        lines = page.objects.get("line", [])
        
        # Create a new PDF to draw on
        c = canvas.Canvas(output_pdf_path, pagesize=letter)

        # Lists to store horizontal and vertical lines' positions
        horizontal_lines = []
        vertical_lines = []

        # Extract horizontal and vertical lines
        for line in lines:
            if 'x0' in line and 'y0' in line and 'x1' in line and 'y1' in line:
                if line['y0'] == line['y1']:  # Horizontal line
                    horizontal_lines.append(line['y0'])  # y0 = y1 for horizontal lines
                elif line['x0'] == line['x1']:  # Vertical line
                    vertical_lines.append(line['x0'])  # x0 = x1 for vertical lines

        # Sort lines to detect gaps
        horizontal_lines = sorted(set(horizontal_lines))  # Remove duplicates and sort
        vertical_lines = sorted(set(vertical_lines))  # Remove duplicates and sort

        # Draw the existing lines (if any)
        c.setStrokeColorRGB(0, 0, 0)  # Black color for original lines
        c.setLineWidth(1)
        for line in lines:
            if 'x0' in line and 'y0' in line and 'x1' in line and 'y1' in line:
                c.line(line['x0'], line['y0'], line['x1'], line['y1'])

        # Draw missing horizontal lines (detect gaps between existing lines)
        for i in range(1, len(horizontal_lines)):
            y_gap = horizontal_lines[i] - horizontal_lines[i - 1]
            if y_gap > 1:  # There is a gap between the horizontal lines
                y_start = horizontal_lines[i - 1]
                y_end = horizontal_lines[i]
                c.setStrokeColorRGB(1, 0, 0)  # Red color for missing lines
                c.setLineWidth(2)
                c.line(0, y_start, page.width, y_start)  # Draw missing horizontal line

        # Draw missing vertical lines (detect gaps between existing lines)
        for i in range(1, len(vertical_lines)):
            x_gap = vertical_lines[i] - vertical_lines[i - 1]
            if x_gap > 1:  # There is a gap between the vertical lines
                x_start = vertical_lines[i - 1]
                x_end = vertical_lines[i]
                c.setStrokeColorRGB(0, 1, 0)  # Green color for missing lines
                c.setLineWidth(2)
                c.line(x_start, 0, x_start, page.height)  # Draw missing vertical line

        # Save the modified PDF with lines
        c.save()

# Example usage
extract_rects_with_width("your_pdf_file.pdf", "output_with_lines.pdf", 0)
