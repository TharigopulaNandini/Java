import pdfplumber
from reportlab.pdfgen import canvas
from reportlab.lib.pagesizes import letter

def extract_rects_with_width(pdf_path, output_pdf_path, page_number=0):
    with pdfplumber.open(pdf_path) as pdf:
        page = pdf.pages[page_number]
        
        # Extract rectangles (bounding boxes of text or table cells)
        rects = page.objects.get("rect", [])
        
        # Create a new PDF to draw on
        c = canvas.Canvas(output_pdf_path, pagesize=letter)
        
        # Dictionary to store table cell coordinates
        cells = []

        # Extract cell coordinates (table cells) and store in cells list
        for rect in rects:
            # Check if the necessary keys exist in the rectangle object
            if 'x0' in rect and 'y0' in rect and 'x1' in rect and 'y1' in rect:
                x0, y0, x1, y1 = rect['x0'], rect['y0'], rect['x1'], rect['y1']
                cells.append((x0, y0, x1, y1))

        # Sort cells by vertical and horizontal positioning to identify rows and columns
        cells.sort(key=lambda cell: (cell[1], cell[0]))  # Sort first by y (rows), then by x (columns)

        # Draw horizontal and vertical lines in missing cells
        for i in range(len(cells)):
            x0, y0, x1, y1 = cells[i]

            # Check for missing horizontal line at the bottom of the cell
            if i + 1 < len(cells) and cells[i+1][1] > y1:  # Check if the next cell is below the current cell
                c.setStrokeColorRGB(1, 0, 0)  # Red color
                c.setLineWidth(2)
                c.line(x0, y1, x1, y1)  # Draw bottom horizontal line for this cell

            # Check for missing vertical line at the right of the cell
            if i + 1 < len(cells) and cells[i+1][0] > x1:  # Check if the next cell is to the right of the current cell
                c.setStrokeColorRGB(0, 1, 0)  # Green color
                c.line(x1, y0, x1, y1)  # Draw right vertical line for this cell

        # Save the modified PDF with lines
        c.save()

# Example usage
extract_rects_with_width("your_pdf_file.pdf", "output_with_lines.pdf", 0)
